<div class="w-full overflow-auto">
  <table class="w-full cursor-pointer" mat-table [dataSource]="dataSource">
    @for (column of displayedColumns; track column) {
    <ng-container [matColumnDef]="column">
      <th class="whitespace-nowrap !bg-slate-300" mat-header-cell *matHeaderCellDef>{{ ColumnName[column] }}
      </th>
      <td class="whitespace-nowrap" mat-cell *matCellDef="let row;let idx = index">
        @if( column === 'STT'){
        {{idx + 1}}
        }
        @else if( column === 'Image'){
        @if(row[column])
        {
        <img loading="lazy" [src]="row[column]" class="h-20 w-20">
        }
        @else {
        <img loading="lazy" src="assets/images/noimage.png" class="p-3 h-20 w-20 rounded-lg">
        }
        }
        @else if( column === 'Soluong'){
        <mat-form-field class="!w-40" appearance="outline" subscriptSizing="dynamic">
          <input matInput type="number" (change)="onValueChange($event,idx)" [(ngModel)]="Giohangs[idx].Soluong"
            [ngModelOptions]="{ standalone: true }"/>
          <button (click)="ChangeSoluong(idx,'giam')" color="primary" matPrefix
            mat-icon-button><mat-icon>do_not_disturb_on</mat-icon></button>
          <button (click)="ChangeSoluong(idx,'tang')" color="primary" matSuffix
            mat-icon-button><mat-icon>add_circle</mat-icon></button>
        </mat-form-field>
        }
        @else if( column === 'Tongtien'){
          {{row[column]||0 |number:'1.0-2'}}đ
        }
        @else {
        {{row[column]}}
        }
      </td>
      <td mat-footer-cell *matFooterCellDef="let row;let idx = index">
        @if( column === 'Soluong'){
         <div class="flex flex-col space-y-2 font-bold">
          <span>Tổng</span>
         </div>
        }
        @if(column === 'Tongtien'){
          <div class="flex flex-col space-y-2 font-bold text-right">
            <span>{{TinhTong(this.Giohangs)||0 |number:'1.0-2'}}đ</span>
           </div>
         }  
      </td>
    </ng-container>
    }
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
  </table>
</div>
<div (click)="AddSanpham()" class="cursor-pointer flex-row inline-flex space-x-2 
bg-slate-200 text-blue-500 hover:bg-blue-500 hover:text-white justify-center items-center m-2  px-4 py-2 border rounded-lg">

  <span>Mua Thêm</span>
  <span class="material-symbols-outlined">
    add_circle
  </span>
</div>
<ng-template #ChonSanphamDialog>
  <div class="lg:w-[70vw] w-[90vw] h-[90vh] p-4 flex flex-col space-y-3">
    <div class="px-4 flex flex-row items-center space-x-2 justify-between">
      <mat-form-field appearance="outline" class="w-full" subscriptSizing="dynamic">
        <input matInput (keyup)="DoSearchSanpham($event)" placeholder="Tìm Sản Phẩm" />
      </mat-form-field>
      <span class="cursor-pointer border p-2 rounded-lg hover:border-2" mat-dialog-close="false">ESC</span>
    </div>
      <div class="overflow-auto flex flex-col w-full space-y-4 lg:p-4">
        <span class="text-red-500">Tìm Thấy {{FilterSanphams.length||0}} Sản Phẩm</span>
        <div class="grid lg:grid-cols-4 grid-cols-2 gap-4">
          @for (items of FilterSanphams; track items) {
          <div (click)="Chonsanpham(items)" class="flex flex-col space-y-2 rounded-lg border p-2"
            mat-dialog-close="true">
            <img [src]="items?.Danhmuc?.Image?.Hinhchinh?.src" class="m-auto h-20 w-20">
            <div>{{items.Title}}</div>
            <div>{{items.MaSP}}</div>
            <div class="cursor-pointer flex flex-row space-x-2">
              @for(item of items.Giagoc;track item){
              <div class="p-2 rounded-lg bg-slate-100 hover:bg-slate-300 font-bold">{{item.khoiluong}} {{item.dvt}} -
                {{item.gia}}</div>
              }
            </div>

          </div>
          }
        </div>
      </div>
  </div>
</ng-template>